## yanagi_MediaToolKit
---
動画とか画像とか文章とか投稿したりをワンコインサーバーでやるやつ 


### 特徴
- git pushするとgithubのコードを読んでデプロイまで全自動でやります
  - ConcourseCIで視認出来ます(たのしい)
- ビルドをローカルでやるので非力なサーバーでも負荷を抑えられます
   - ビルドフェーズを分けているためCIでもキャッシュが効き、最短数分でデプロイが完了します
   - 外部サービスになるべく依存しないためコストを抑えられます
- 更新時のダウンタイムがありません
  - コンテナを2つ配置してnginxでリバースプロキシし、swarmで順次アップデートします
- ItamaeスクリプトでDebianサーバーにSSH接続すればデプロイ可能な環境が整います

### 注記
- ローカルでConcourseCIとDockerレジストリを立てる必要があります
  - その間の通信をLetsEncrypt証明書(DNS認証でローカルIP用に取得)で解決してます
    - DNS自体は外部にあります
    - 認証局とDNSを自前で立てられるならきっとそっちのほうが楽です
       - (信用させるのにConcourseCIが動的に生成するコンテナの設定が絡むので諦めました)
- 本体にPythonを含むためDebian、RDBほかにAlpine使ってます
- コンテナまるまる投げるので転送量は増えます(クラウドサービスでなくVPSを想定)
- RDBコンテナは1つで、push時に自動アップデートされません

### 環境
- win10

### その他
- フロントはVue2(Vuetify), バックはFastAPIです
  - ドラッグ&ドロップで画像をぶん投げたりできます
- 一応一通り動くはずですが転用しても割に合わないと思うので、誰かの参考程度に

### 履歴
- 2022.09 個人情報を削除して公開
- 2021.09-12 ざっくり開発
